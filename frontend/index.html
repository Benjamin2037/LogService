<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LogService</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body data-mode="timeline">
    <div class="bg-wash"></div>
    <main class="app">
      <header class="hero">
        <div class="badge">Timeline-first Console</div>
        <h1>LogService</h1>
        <p>Start from the timeline, zoom into the incident window, then extract the safest 100 lines.</p>
        <div class="hero-pills">
          <span class="pill" id="status">idle</span>
          <span class="pill">cap 100 lines</span>
          <span class="pill">local-only</span>
        </div>
      </header>

      <section class="panel timeline-panel">
        <div class="panel-header">
          <div>
            <h2>Incident Timeline</h2>
            <p class="helper mode-only-timeline">Drag or click events to set the time window.</p>
            <p class="helper mode-only-hybrid">Pick a window, then refine with guided inputs.</p>
          </div>
          <div class="timeline-actions">
            <button class="chip" data-range="15">Last 15m</button>
            <button class="chip" data-range="30">Last 30m</button>
            <button class="chip" data-range="60">Last 1h</button>
          </div>
        </div>
        <div class="timeline">
          <div class="timeline-track">
            <div class="timeline-window" id="timelineWindow"></div>
            <button class="event" data-event="2026-01-28T06:12:42Z" style="left: 18%">leader campaign</button>
            <button class="event" data-event="2026-01-28T06:19:16Z" style="left: 42%">ready slow</button>
            <button class="event" data-event="2026-01-28T06:22:49Z" style="left: 58%">ready slow</button>
            <button class="event" data-event="2026-01-28T06:24:47Z" style="left: 72%">new image ready</button>
            <button class="event" data-event="2026-01-28T06:25:16Z" style="left: 85%">restart</button>
          </div>
          <div class="ticks">
            <span>14:10</span>
            <span>14:15</span>
            <span>14:20</span>
            <span>14:25</span>
          </div>
        </div>
      </section>

      <section class="layout">
        <div class="left-col">
          <section class="panel filters-panel">
            <div class="panel-header">
              <div>
                <h2>Guided Filters</h2>
                <p class="helper mode-only-guided">Follow the steps. We only ask for what changes the result.</p>
                <p class="helper mode-only-timeline">Minimal inputs for timeline-driven search.</p>
                <p class="helper mode-only-hybrid">Timeline + guided inputs for precision.</p>
              </div>
              <div class="mode-switch">
                <button class="mode-btn" data-mode="timeline">Timeline</button>
                <button class="mode-btn" data-mode="guided">Guided</button>
                <button class="mode-btn" data-mode="hybrid">Hybrid</button>
              </div>
            </div>

            <div class="step">
              <div class="step-title">Step 1 路 Target</div>
              <div class="grid">
                <label>
                  Cluster ID
                  <input id="clusterId" placeholder="us-east-1-f02" />
                </label>
                <label>
                  Cluster Config Path
                  <input id="configPath" placeholder="/path/to/cluster.json" />
                </label>
              </div>
            </div>

            <div class="step">
              <div class="step-title">Step 2 路 Scope</div>
              <label>
                Components (comma)
                <input id="components" placeholder="pd,tikv" />
              </label>
              <div class="chips" aria-label="component presets">
                <button class="chip" data-component="pd">PD</button>
                <button class="chip" data-component="tidb">TiDB</button>
                <button class="chip" data-component="tikv">TiKV</button>
                <button class="chip" data-component="tiflash">TiFlash</button>
                <button class="chip" data-component="tiflow">TiFlow</button>
                <button class="chip" data-component="ticdc">TiCDC</button>
              </div>
            </div>

            <div class="step">
              <div class="step-title">Step 3 路 Keywords</div>
              <label>
                Keywords (comma)
                <input id="keywords" placeholder="leader, ready" />
              </label>
              <div class="chips" aria-label="keyword suggestions">
                <button class="chip" data-keyword="leader">leader</button>
                <button class="chip" data-keyword="ready">ready</button>
                <button class="chip" data-keyword="campaign">campaign</button>
                <button class="chip" data-keyword="timeout">timeout</button>
                <button class="chip" data-keyword="slow">slow</button>
              </div>
            </div>

            <div class="step">
              <div class="step-title">Step 4 路 Time Range</div>
              <div class="grid">
                <label>
                  Start (ISO)
                  <input id="startTime" placeholder="2026-02-02T08:00:00Z" />
                </label>
                <label>
                  End (ISO)
                  <input id="endTime" placeholder="2026-02-02T08:15:00Z" />
                </label>
              </div>
            </div>

            <div class="actions">
              <button id="runQuery">Run Query</button>
              <button id="exportText" class="ghost">Export Text</button>
            </div>
          </section>

          <section class="panel compact">
            <h3>Suggested Skills</h3>
            <div class="skills">
              <div class="skill-card">
                <strong>PD leader ready slowdown</strong>
                <p>Focus on election, readiness gaps, and upgrade signals.</p>
              </div>
              <div class="skill-card">
                <strong>Gateway SLA drops</strong>
                <p>Correlate SLA dips with component restarts.</p>
              </div>
            </div>
          </section>
        </div>

        <div class="right-col">
          <section class="panel">
            <div class="panel-header">
              <h2>Conversation</h2>
            </div>
            <div class="chat" id="chat">
              <div class="empty-state">
                <strong>Pick a window from the timeline.</strong>
                <p>We will only fetch the minimum required lines.</p>
              </div>
            </div>
          </section>

          <section class="panel compact">
            <h3>Safety & Output</h3>
            <ul class="safety-list">
              <li>Hard cap: 100 lines per response.</li>
              <li>Cooldown enforced to protect clusters.</li>
              <li>Local-only auth storage with encryption.</li>
            </ul>
          </section>
        </div>
      </section>
    </main>

    <script src="app.js"></script>
  </body>
</html>
